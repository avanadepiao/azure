# プロジェクト 1: リフトアンドシフト

プロジェクトは、独自のソリューションを設計してデプロイするために、Azure に専念する機会です。

これまでに学んだすべての主要なスキルを使用し、以下のことを経験します：

- 😣 行き詰まることがあります
- 💥 エラーや壊れたアプリに直面します
- 📑 調査やトラブルシューティングが必要になります

**これがプロジェクトが非常に有用な理由です！**

どの分野に自信があり、どこにもっと時間をかける必要があるかを理解するのに役立ちます。

最初のプロジェクトは _リフトアンドシフト_ です。これは、既存のアプリケーションをクラウドで実行したいが、アーキテクチャやコードを変更したくない場合によく取られるアプローチです。多くの企業がクラウドを始める際の最初のアプローチです。

## アプリケーションアーキテクチャ

プロジェクトアプリは、シンプルなToDoリストアプリケーションです。Webベースなので、ブラウザからアクセスし、やるべきことのリストを追加できます：

![プロジェクト 1 アプリ](/img/project-1-app.png)

このバージョンのアプリには、Webアプリケーションとバックエンドデータベースの2つのコンポーネントがあります：

![プロジェクト 1 アーキテクチャ](/img/project-1-arch.png)

## 🥅 目標

全体的な目標は、アプリを Azure で実行することです。

手元にあるのはソースコードといくつかの設定に関するドキュメントのみですが、それがすべてです。

本当に必要なのは：

- 小さなデータベースと単一のアプリインスタンスを持つテスト環境
- より大きなデータベースと複数のアプリインスタンスを持つ*別個*の本番環境

どちらの環境も完全に自動化されたデプロイメントが必要です。

**単一のコマンドを実行するだけでアプリケーションをゼロから立ち上げることができるべきです。**

Azure のサービスやデプロイメントのモデリング方法は自由に選択できます。

## 覚えておくこと...

_探索 | デプロイ | 自動化_

## 開発環境

まずはアプリケーションをローカルで実行してみることが良いアイデアです。これにより、アプリの見た目を把握できます。

> [.NET 6 SDK](https://dotnet.microsoft.com/ja-jp/download) のインストールが必要です

ソースコードフォルダをターミナルセッションで開き、アプリを実行します：



```
cd projects/lift-and-shift/src

dotnet run
```


ログにいくつかの出力が表示されます。

- http://localhost:5000 でアプリをブラウズします
- devデプロイメントではローカルデータベースを使用するので、SQL Server を実行する必要はありません
- ToDo項目を追加してリストに表示されることを確認します
- 診断ページを開いて、どのような情報が表示されるか確認します

## 設定

アプリケーションは標準的な .NET 設定モデルを使用しています。デフォルト設定は
[appsettings.json](/projects/lift-and-shift/src/appsettings.json) ファイルにあります。**そのファイルを変更してはいけません**。これには、ソースコードリポジトリでの実行に適切な設定が含まれています。

Azure にデプロイする際には、クラウド環境のいくつかの設定を変更する必要があります：

- `Database__Provider` は `SqlServer` に設定する必要があります
- `ConnectionStrings__ToDoDb` には SQL Server データベースへの完全な接続文字列が必要です
- `ConfigController__Enabled` は `true` に設定できます。その場合、アプリは /config ページを公開し、ロードされた設定を確認できます

## テスト

Azure でアプリが動作している場合、以下が可能である必要があります：

- URL にアクセスし、エラーなしでアプリを表示できること
- ToDo項目を追加し、リストに表示されること
- SQL Server で ToDo 項目を照会できること

## ストレッチ

すべてが完了したら、デプロイメントをさらに本番環境に近づける方法について考えてみてください。スケール、高可用性、アプリケーションアップグレードのロールアウトプロセスなどを考慮する価値があります。
